{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
  .left-link {
    display: block;
    padding: 10px 20px;
    margin-bottom: 10px;
    border-radius: 5px;
    color: #333;
    text-decoration: none;
    transition: background-color 0.3s ease;
  }

  .left-link:hover {
      background-color: #f0f0f0;
  }

  .left-link.active {
      font-weight: bold;
      background-color: #007bff;
      color: #fff;
  }

  .password-link {
      display: block;
      margin-top: 20px;
      color: #007bff;
  }
</style>

<section class="vh-90" style="background-color:#f0f0f0;">
  <div class="mask d-flex align-items-center h-100 gradient-custom-3">
    <div class="container h-80">
      <div class="row d-flex justify-content-center h-80">
        <div class="col col-lg-4 col-xl-4">
          <div class="card left-link-panel">
              <a href="/profile" class="{% if request.path == '/profile' %}active{% endif %} left-link">Profile</a>
              {% if roll == 'seller' and choice == 'yes' %}
                  <a href="/addproduct_data" class="{% if request.path == '/addproduct_data' %}active{% endif %} left-link">Post Products</a>
                  <a href="/myproducts" class="{% if request.path == '/myproducts' %}active{% endif %} left-link">My products</a>
              {% elif roll == 'company' %}
                  <a href="/jobpost" class="{% if request.path == '/jobpost' %}active{% endif %} left-link">Post jobs</a>
              {% endif %}
              {% if roll == 'seller' %}
              {% elif roll == 'company' %}
                  <a href="/myjob" class="{% if request.path == '/myjob' %}active{% endif %} left-link">my jobs</a>
                  <a href="/people_applied" class="{% if request.path == '/people_applied' %}active{% endif %} left-link">people applied</a>
              {% endif %}
              <a href="/order-history" class="{% if request.path == '/order-history' %}active{% endif %} left-link">Order history</a>
              <a href="/logout" class="{% if request.path == '/logout' %}active{% endif %} left-link">Logout</a>
          </div>
<<<<<<< HEAD
          
            <div class="col-8 col-md-8 col-lg-8 col-xl-8" style="margin-bottom:50px; margin-top:50px">
                
                  <h3 class="text-uppercase text-center mb-3">Edit Job</h3>
                  <form method='post' enctype="multipart/form-data" style="margin-bottom: 50px;" id="jobedit-form">
                    {% csrf_token %}
                    <div class="form-outline mb-4">   
                      <select name="job_category" class="form-control form-control-lg">
                        {% for job in all_jobs %}
                        <option value="{{job.id}}">{{job.title}}</option>
                        {% endfor %}
                      </select>    
                      <label class="form-label" for="Catagory"></label>
                    </div>
                    <div class="form-outline mb-4">
                      <input type="text" id="form3Example3cg" name="title" class="form-control form-control-lg" placeholder="Name of the job" value='{{job_value.title}}' required >
                      <label class="form-label" for="title"></label>
                    </div>
    
                    <div class="form-outline mb-4">
                      <input type="number"  name="salary" placeholder="Salary (₹10,000 - ₹50,00,000)" class="form-control form-control-lg" value='{{job_value.salary}}' min="10000" max="5000000" step="1000" required >
                      <label class="form-label" for="price" ></label>
                      <small class="form-text text-muted">Salary must be between ₹10,000 and ₹50,00,000</small>
                    </div>
                    <div class="form-outline mb-4">
                      <textarea name="description" rows="5" class="form-control form-control-lg" placeholder="Description">{{job_value.description}}</textarea>
                      <label class="form-label" for="description"></label>
                    </div>
                    <div class="form-outline mb-4">
                        <textarea name="skills" rows="5" class="form-control form-control-lg" placeholder="skills required for the job" >{{job_value.skills}}</textarea>
                        <label class="form-label" for="skills"></label>
                      </div>
                    <div class="form-outline mb-4">
                      <img id='job-image' src="{{job_value.image.url}}" width="250px;" height="250px;">
                      <label class="form-label" for="Image"><b>picture of the company</b></label>
                      <input type="file" id='jobimg' class="form-control form-control-lg" name="image" />
                    </div>
                    <div class="d-flex justify-content-center">
                      <button type="submit" class="btn btn-success btn-block btn-lg gradient-custom-4 text-body">Post Job</button>
                    </div>
                  </form>
=======
      </div>
      
        <div class="col-8 col-md-8 col-lg-8 col-xl-8" style="margin-bottom:50px; margin-top:50px">
            
              <h3 class="text-uppercase text-center mb-3">Edit Job</h3>
              <form method='post' enctype="multipart/form-data" style="margin-bottom: 50px;" id="jobedit-form">
                {% csrf_token %}
                <div class="form-outline mb-4">   
                  <select name="job_category" class="form-control form-control-lg">
                    {% for job in all_jobs %}
                    <option value="{{job.id}}" {% if job.id == job_value.job_category.id %}selected{% endif %}>{{job.title}}</option>
                    {% endfor %}
                  </select>    
                  <label class="form-label" for="Category"></label>
                </div><br>
                <div class="form-outline mb-4">
                  <input type="text" id="form3Example3cg" name="title" class="form-control form-control-lg" placeholder="Name of the job" value='{{job_value.title}}' required >
                  <label class="form-label" for="title"></label>
>>>>>>> 8246f7f1f8ebec01b3afc79bcbc0af2bd80ba7dd
                </div>

                <div class="form-outline mb-4">
                  <input type="number" name="salary" placeholder="Salary" class="form-control form-control-lg" value='{{job_value.salary}}' required min="1" max="1000000" step="1" id="salary-input">
                  <label class="form-label" for="salary"></label>
                  <div id="salary-error" class="text-danger" style="display: none; font-weight: bold; margin-top: 5px;"></div>
                </div>
                <div class="form-outline mb-4">
                  <textarea name="description" rows="5" class="form-control form-control-lg" placeholder="Description">{{job_value.description}}</textarea>
                  <label class="form-label" for="description"></label>
                </div>
                <div class="form-outline mb-4">
                    <textarea name="skills" rows="5" class="form-control form-control-lg" placeholder="skills required for the job">{{job_value.skills}}</textarea>
                    <label class="form-label" for="skills"></label>
                  </div>
                <div class="form-outline mb-4">
                  <img id='job-image' src="{{job_value.image.url}}" width="250px;" height="250px;">
                  <label class="form-label" for="Image"><b>picture of the company</b></label>
                  <input type="file" id='jobimg' class="form-control form-control-lg" name="image" />
                </div>
                <div class="d-flex justify-content-center">
                  <button type="submit" class="btn btn-success btn-block btn-lg gradient-custom-4 text-body">Update Job</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        $('#jobedit-form').on('submit', function(event) {
            event.preventDefault();
<<<<<<< HEAD

            // Validate salary range
            var salary = parseFloat($('input[name="salary"]').val());
            if (salary < 10000 || salary > 5000000) {
                alert("Salary must be between ₹10,000 and ₹50,00,000");
                return;
            }

=======
            
            // Salary validation
            var salary = $('#salary-input').val();
            var salaryError = $('#salary-error');
            salaryError.hide();
            if (!salary) { salaryError.text('Salary is required').show(); return; }
            if (salary <= 0) { salaryError.text('Salary must be greater than zero').show(); return; }
            if (!Number.isInteger(parseFloat(salary))) { salaryError.text('Salary must be a whole number (no decimals)').show(); return; }
            if (parseFloat(salary) > 1000000) { salaryError.text('Salary cannot exceed ₹10,00,000 (10 lakhs)').show(); return; }
            
>>>>>>> 8246f7f1f8ebec01b3afc79bcbc0af2bd80ba7dd
            var csrfToken = $('[name=csrfmiddlewaretoken]').val();
            var formData = new FormData(this);
               $.ajax({
                type: 'POST',
                url: '/editjob{{job.id}}',
                data: formData,
                processData: false,
                contentType: false,
                  success: function(response) {
<<<<<<< HEAD
                      alert("Job Updated Successfully");
                  },
                  error: function(response) {
                      alert("Error updating job");
=======
                      alert('Job updated successfully');
                      window.location.href = '/myjob';
                  },
                  error: function(response) {
                      alert('Error updating job');
>>>>>>> 8246f7f1f8ebec01b3afc79bcbc0af2bd80ba7dd
                  }
              });
            });
            
            $('#jobimg').on('change', function () {
                var input = this;
              
                if (input.files && input.files[0]) {
                  var reader = new FileReader();
              
                  reader.onload = function (e) {
                    // Update the preview image src attribute
                    $('#job-image').attr('src', e.target.result);
                  };
              
                  reader.readAsDataURL(input.files[0]);
                }
              });
              
            // Real-time salary validation
            $('#salary-input').on('input', function() {
                var salary = $(this).val();
                var salaryError = $('#salary-error');
                salaryError.hide();
                if (salary) {
                    if (salary <= 0) { salaryError.text('Salary must be greater than zero').show(); }
                    else if (!Number.isInteger(parseFloat(salary))) { salaryError.text('Salary must be a whole number (no decimals)').show(); }
                    else if (parseFloat(salary) > 1000000) { salaryError.text('Salary cannot exceed ₹10,00,000 (10 lakhs)').show(); }
                }
            });
            </script>
    {%endblock %}